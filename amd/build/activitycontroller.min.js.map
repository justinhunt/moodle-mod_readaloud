{"version":3,"file":"activitycontroller.min.js","sources":["../src/activitycontroller.js"],"sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log', \"core/str\",'mod_readaloud/definitions',\n        'mod_readaloud/recorderhelper', 'mod_readaloud/modelaudiokaraoke',\n        'core/ajax','core/notification','mod_readaloud/smallreporthelper',\n        'mod_readaloud/practice','mod_readaloud/quizhelper','mod_readaloud/clicktohear'\n    ],\n    function ($, log, str,def, recorderhelper, modelaudiokaraoke,\n              Ajax, notification, smallreporthelper, practice, quizhelper, clicktohear) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Activity controller: initialising');\n\n     // Disable click event.\n     function disableClick(e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n    }\n\n    return {\n\n        cmid: null,\n        activitydata: null,\n        holderid: null,\n        recorderid: null,\n        playerid: null,\n        sorryboxid: null,\n        controls: null,\n        ra_recorder: null,\n        rec_time_start: 0,\n        steps_enabled: {},\n        steps_open: {},\n        steps_complete: {},\n        letsshadow: false,\n        strings: {},\n\n\n        //CSS in this file\n        passagefinished: def.passagefinished,\n\n        //for making multiple instances\n        clone: function () {\n            return $.extend(true, {}, this);\n        },\n\n        //pass in config, the jquery video/audio object, and a function to be called when conversion has finshed\n        init: function (props) {\n            var dd = this.clone();\n\n            log.debug('Steps enabled:', props.stepsenabled);\n            log.debug('Steps open:', props.stepsopen);\n            log.debug('Complete:', props.stepscomplete);\n            log.debug('Steps enabled:', props.stepsenabled);\n            log.debug('props:');\n            log.debug(props);\n            log.debug(props,'props:');\n\n\n            //pick up opts from html\n            var theid = '#amdopts_' + props.widgetid;\n            var configcontrol = $(theid).get(0);\n            if (configcontrol) {\n                dd.activitydata = JSON.parse(configcontrol.value);\n                $(theid).remove();\n            } else {\n                //if there is no config we might as well give up\n                log.debug('Read Aloud Test Controller: No config found on page. Giving up.');\n                return;\n            }\n\n            dd.cmid = props.cmid;\n            dd.holderid = props.widgetid + '_holder';\n            dd.recorderid = props.widgetid + '_recorder';\n            dd.playerid = props.widgetid + '_player';\n            dd.sorryboxid = props.widgetid + '_sorrybox';\n\n            //if the browser doesn't support html5 recording.\n            //then warn and do not go any further\n            if (!dd.is_browser_ok()) {\n                $('#' + dd.sorryboxid).show();\n                return;\n            }\n\n            // Set up steps - enabled and open\n            //TO DO make these usable in JS (here) and not just in mustache\n            dd.steps_enabled = dd.activitydata.stepsenabled; // this is not passed through to JS (only mustache)\n            dd.steps_open = dd.activitydata.stepsopen;// this is not passed through to JS (only mustache)\n            dd.steps_complete = dd.activitydata.stepscomplete;// this is not passed through to JS (only mustache)\n\n            // Set up model audio.\n            dd.setupmodelaudio();\n\n            // Set up listen and repeat.\n            dd.setuppractice();\n\n            // Init recorder and html and events.\n            dd.setup_recorder();\n            dd.process_html(dd.activitydata);\n\n            dd.register_events();\n            dd.setup_strings();\n\n            // Set up quiz.\n            dd.setupquiz();\n\n            //Set up click to hear\n            dd.setupclicktohear();\n\n            //Set up small report helper\n            smallreporthelper.init(dd.activitydata);\n\n            // Set initial mode.\n            // We used to check the settings but now we just show the non-options greyed out\n            if(dd.stepshadow_enabled || dd.steplisten_enabled || true){\n                dd.domenulayout();\n            } else {\n                dd.doreadinglayout();\n            }\n        },\n\n        setup_strings: function(){\n            var dd = this;\n            // Set up strings\n            str.get_strings([\n                { \"key\": \"confirm_cancel_recording\", \"component\": def.component},\n                { \"key\": \"confirm_read_again\", \"component\": def.component},\n                //more strings here\n            ]).done(function (s) {\n                var i = 0;\n                dd.strings.confirm_cancel_recording = s[i++];\n                dd.strings.confirm_read_again = s[i++];\n                //more strings here\n            });\n        },\n\n        setupmodelaudio: function(){\n            var karaoke_opts={breaks:this.activitydata.breaks, audioplayerclass:this.activitydata.audioplayerclass };\n            modelaudiokaraoke.init(karaoke_opts);\n        },\n\n        setuppractice: function(){\n            var dd = this;\n            var practice_opts={modelaudiokaraoke: modelaudiokaraoke, cmid: this.cmid, language: this.activitydata.language,\n                region: this.activitydata.region, phonetics: this.activitydata.phonetics, stt_guided: this.activitydata.stt_guided};\n            practice.init(practice_opts);\n            //set the callback function to complete the activity\n            practice.on_complete = function(){\n                // Complete the current step (update server and ui)\n                dd.update_activity_step(dd.activitydata.steps.step_practice);\n            }\n        },\n\n        setupclicktohear: function(){\n            var dd = this;\n            var clicktohear_opts={token: dd.activitydata.token, ttsvoice: dd.activitydata.ttsvoice,\n                region: dd.activitydata.region, owner: dd.activitydata.owner};\n            clicktohear.init(clicktohear_opts);\n        },\n\n        setupquiz: function(){\n            var dd = this;\n            //hack TO DO - get the real attempt id\n            dd.attemptid = 1;\n\n            quizhelper.init(dd.activitydata,\n                dd.cmid,\n                dd.attemptid);\n\n            //set the callback function to complete the quiz\n            quizhelper.on_complete = function(){\n                // Complete the current step (update server and ui)\n                dd.update_activity_step(dd.activitydata.steps.step_quiz);\n            }\n        },\n\n        process_html: function (opts) {\n            //these css classes/ids are all passed in from php in\n            //renderer.php::fetch_activity_amd should maybe just simplify and declare them in definitions.js\n            var controls = {\n                hider: $('.' + opts['hider']),\n                introbox: $('.' + 'mod_intro_box'),\n                progresscontainer: $('.' + opts['progresscontainer']),\n                feedbackcontainer: $('.' + opts['feedbackcontainer']),\n                errorcontainer: $('.' + opts['errorcontainer']),\n                passagecontainer: $('.mod_readaloud_readingcontainer ' +  '.' + opts['passagecontainer']),\n                reviewpassagecontainer: $('.mod_readaloud_studentreportpassage ' +  '.' + opts['passagecontainer']),\n                recordingcontainer: $('.' + opts['recordingcontainer']),\n                dummyrecorder: $('.' + opts['dummyrecorder']),\n                recordercontainer: $('.' + opts['recordercontainer']),\n                menubuttonscontainer: $('.' + opts['menubuttonscontainer']),\n                menuinstructionscontainer: $('.' + opts['menuinstructionscontainer']),\n                previewinstructionscontainer: $('.' + opts['previewinstructionscontainer']),\n                practiceinstructionscontainer: $('.' + opts['practiceinstructionscontainer']),\n                practicecontainerwrap: $('.' +  opts['practicecontainerwrap']),\n                activityinstructionscontainer: $('.' + opts['activityinstructionscontainer']),\n                recinstructionscontainerright: $('.' + opts['recinstructionscontainerright']),\n                recinstructionscontainerleft: $('.' + opts['recinstructionscontainerleft']),\n                allowearlyexit: $('.' + opts['allowearlyexit']),\n                wheretonextcontainer: $('.' + opts['wheretonextcontainer']),\n                modelaudioplayer: $('#' + opts['modelaudioplayer']),\n                homebutton: $('#' + opts['homebutton']),\n                startlistenbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_listen + '\"]'),\n                startpracticebutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_practice + '\"]'),\n                startreadbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_read + '\"]'),\n                startshadowbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_shadow + '\"]'),\n                startquizbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_quiz + '\"]'),\n                readagainbutton: $('#' + opts['readagainbutton']),\n                startreportbutton: $('#' + opts['startreportbutton'] + ' .mode-chooser[data-step=\"' + opts.steps.step_report + '\"]'),\n                returnmenubutton: $('#' + opts['returnmenubutton']),\n                stopandplay: $('#' + opts['stopandplay']),\n                smallreportcontainer: $('#' + opts['smallreportcontainer']),\n                fullreportcontainer: $('#' + opts['fullreportcontainer']),\n                readingcontainer: $('#' + def.readingcontainer),\n                modeimagecontainer: $('#' + opts['modeimagecontainer']),\n                modejourneycontainer: $('#' + opts['modejourneycontainer']),\n                quizcontainer: $('.' +  opts['quizcontainer']),\n                quizcontainerwrap: $('.' +  opts['quizcontainerwrap']),\n                quizplaceholder: $('.' +  opts['quizplaceholder']),\n                quizresultscontainer: $(\".\" + opts['quizresultscontainer']),\n                homecontainer: $('.' +  opts['homecontainer']),\n            };\n            this.controls = controls;\n        },\n\n        is_browser_ok: function () {\n            return (navigator && navigator.mediaDevices\n                && navigator.mediaDevices.getUserMedia);\n        },\n\n        reset_recorder: function () {\n            recorderhelper.reset();\n            this.setup_recorder();\n        },\n\n        setup_recorder: function () {\n            var dd = this;\n\n            //after the recorder reports that it has (really) started this functuon is called.\n            var beginall= function(){\n                dd.passagerecorded = true;\n                if(dd.stepshadow_enabled && dd.letsshadow){\n                    dd.controls.modelaudioplayer[0].play();\n                }\n            };\n\n            var on_speech = function (eventdata) {\n                var speech = eventdata.capturedspeech;\n                var speechresults = eventdata.speechresults;\n            };\n\n            //originates from the recording:started event\n            //contains no meaningful data\n            //See https://api.poodll.com\n            var on_recording_start = function (eventdata) {\n                dd.rec_time_start = new Date().getTime();\n                dd.dopassagelayout();\n\n               // dd.controls.passagecontainer.show(1000, beginall);\n                dd.controls.passagecontainer.show(500,beginall);\n                dd.controls.passagecontainer[0].scrollIntoView({behaviour: \"smooth\", block: \"start\", inline: \"nearest\"});\n\n                /*\n                var scrollparent = $(\"#page\");\n                var newtop = scrollparent.scrollTop() + dd.controls.passagecontainer.offset().top - scrollparent.offset().top;\n                if(newtop<0) {newtop=0;}\n                scrollparent.animate({scrollTop: newtop}, 500,beginall);\n                */\n\n            };\n\n            //originates from the recording:ended event\n            //contains no meaningful data\n            //See https://api.poodll.com\n            var on_recording_end = function (eventdata) {\n                //its a bit hacky but the rec end event can arrive immed. somehow probably when the mic test ends\n                var now = new Date().getTime();\n                if ((now - dd.rec_time_start) < 3000) {\n                    return;\n                }\n                dd.douploadlayout();\n                //if we are shadowing we should stop the audio player.\n                if(dd.stepshadow_enabled && dd.letsshadow){\n                    dd.controls.modelaudioplayer[0].currentTime=0;\n                    dd.controls.modelaudioplayer[0].pause();\n                }\n            };\n\n            //data sent here originates from the awaiting_processing event\n            //See https://api.poodll.com\n            var on_audio_processing = function (eventdata) {\n                //at this point we know the submission has been uploaded and we know the fileURL\n                //so we send the submission\n                var now = new Date().getTime();\n                var rectime = now - dd.rec_time_start;\n                if (rectime > 0) {\n                    rectime = Math.ceil(rectime / 1000);\n                }\n\n                dd.send_submission(eventdata.mediaurl, rectime);\n\n                // Complete the current step (update server and ui)\n                dd.update_activity_step(dd.activitydata.steps.step_read);\n\n                // Send user to the finished report immediately\n                smallreporthelper.update_filename(eventdata.mediaurl);\n                smallreporthelper.start_check_for_results();\n                dd.doreportlayout();\n            };\n\n            //init the recorder\n            recorderhelper.init(dd.activitydata,\n                on_recording_start,\n                on_recording_end,\n                on_audio_processing,\n                on_speech);\n        },\n\n        register_events: function () {\n            var dd = this;\n\n            $('.mode-chooser.no-click').each(function() {\n                this.addEventListener('click', disableClick, true);\n                this.addEventListener('keypress', disableClick, true);\n            });\n\n            dd.controls.startlistenbutton.click(function(e){\n                dd.dopreviewlayout();\n                  // TO DO: where to set this properly?\n                  // Complete the current step (update server and ui).\n                  dd.update_activity_step(dd.activitydata.steps.step_listen);\n            });\n            dd.controls.startlistenbutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13 ) {\n                    dd.dopreviewlayout();\n                    e.preventDefault();\n                   // TO DO: where to set this properly?\n                  // Complete the current step (update server and ui).\n                  dd.update_activity_step(dd.activitydata.steps.step_listen);\n                }\n            });\n            dd.controls.startpracticebutton.click(function(e){\n                dd.dopracticelayout();\n            });\n            dd.controls.startpracticebutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13 ) {\n                    dd.dopracticelayout();\n                    e.preventDefault();\n                }\n            });\n            dd.controls.startreadbutton.click(function(e){\n                if(dd.steps_complete.step_read){\n                    dd.doreportlayout();\n                }else{\n                    dd.letsshadow=false;\n                    dd.doreadinglayout();\n                }\n            });\n            dd.controls.startreadbutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13) {\n                    if(dd.steps_complete.step_read){\n                        dd.doreportlayout();\n                    }else{\n                        dd.letsshadow=false;\n                        dd.doreadinglayout();\n                    }\n                    e.preventDefault();\n                }\n            });\n\n            dd.controls.readagainbutton.click(function(e){\n                var result = confirm(dd.strings.confirm_read_again);\n                    //exit if they dont want to\n                    if (!result) {\n                        return;\n                    }\n                //reset the recorder and start again\n                dd.reset_recorder();\n                dd.letsshadow=false;\n                dd.doreadinglayout();\n            });\n\n            dd.controls.readagainbutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13) {\n                    dd.letsshadow=false;\n                    dd.doreadinglayout();\n                    e.preventDefault();\n                }\n            });\n\n            dd.controls.startshadowbutton.click(function(e){\n                //practice shadowing\n                //dd.dopracticelayout();\n                // practice.shadow=true;\n\n                dd.letsshadow=true;\n                dd.doreadinglayout();\n            });\n            dd.controls.startshadowbutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13) {\n                    //dd.dopracticelayout();\n                    //practice.shadow=true;\n\n                    dd.letsshadow=true;\n                    dd.doreadinglayout();\n                    e.preventDefault();\n                }\n            });\n            dd.controls.returnmenubutton.click(function(e){\n                //in most cases ajax hide show is ok, but L&R stuffs up android for normal readaloud so we reload\n                if(dd.isandroid() && dd.controls.practiceinstructionscontainer.is(\":visible\")) {\n                    location.reload();\n                }else if(dd.controls.readingcontainer.is(\":visible\")\n                    && dd.controls.passagecontainer.hasClass('readmode')\n                    && dd.controls.passagecontainer.is(\":visible\")){\n                    // Display a confirmation dialog\n                    var result = confirm(dd.strings.confirm_cancel_recording);\n                    //there is no way to stop the recorder early, so just reload the page, brutal\n                    if (result) {\n                        location.reload();\n                    }\n                }else {\n                    dd.controls.modelaudioplayer[0].currentTime = 0;\n                    dd.controls.modelaudioplayer[0].pause();\n                    dd.domenulayout();\n                }\n            });\n\n            dd.controls.startreportbutton.click(function(e){\n                dd.doreportlayout();\n            });\n            dd.controls.startreportbutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13 ) {\n                    dd.doreportlayout();\n                }\n            });\n\n            dd.controls.startquizbutton.click(function(e){\n                dd.doquizlayout();\n            });\n            dd.controls.startquizbutton.keypress(function(e){\n                if (e.which == 32 || e.which == 13 ) {\n                    dd.doquizlayout();\n                    e.preventDefault();\n                }\n            });\n            dd.controls.homebutton.click(function(e){\n                dd.domenulayout();\n            });\n\n            dd.controls.stopandplay.on('click', 'button.control--playbutton', function () {\n                var $btn = $(this);\n                var pressed = $btn.attr('aria-pressed') === 'true';\n                $btn.attr('aria-pressed', pressed ? 'false' : 'true');\n            });\n\n            dd.controls.stopandplay.on('keypress', 'button.control--playbutton', function (e) {\n                if (e.which == 32 || e.which == 13) { // Space or Enter\n                    var $btn = $(this);\n                    var pressed = $btn.attr('aria-pressed') === 'true';\n                    $btn.attr('aria-pressed', pressed ? 'false' : 'true');\n                    e.preventDefault();\n                }\n            });\n        },\n\n        // when a step is completed, we update the activity completion on the server\n        // and open the next step\n        update_activity_step: function (step) {\n            var that = this;\n            Ajax.call([{\n                methodname: 'mod_readaloud_report_activitystep_completion',\n                args: {\n                    cmid: that.cmid,\n                    step:  step\n                },\n                done: function(ajaxresult){\n                    var success = JSON.parse(ajaxresult);\n                    switch (success) {\n                        case true:\n                            var adata = that.activitydata;\n                            for (var key in adata.steps) {\n                                var thestep = adata.steps[key];\n                                if (thestep === step) {\n                                    that.activitydata.stepscomplete[key] = true;\n                                } else {\n                                    continue;\n                                }\n                            }\n                            that.updateModeStatuses();\n                            that.updateBigButtonMenuModeStatus();\n                            that.open_next_step(step);\n\n                            break;\n                        case false:\n                        default:\n                            log.debug('step ' + step + ' update failed');\n                    }\n\n                },\n                fail: notification.exception\n            }]);\n        },\n\n        open_next_step: function(oldstep){\n            var that = this;\n            var adata = this.activitydata;\n            //loop through adata.steps array\n            //this looks like['step_listen': 1, 'step_practice': 2, 'step_shadow': 4, 'step_read': 8, 'step_quiz': 16]\n            for (var key in adata.steps) {\n                var thestep = adata.steps[key];\n                //if the looped step is less than or equal to the old step, skip\n                if (thestep <= oldstep) {\n                    continue;\n                } else {\n                    //if the looped step is enabled (present on page), open it\n                    var step_chooser = $('#' + adata['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + thestep + '\"]');\n                    log.debug(step_chooser);\n                    if(step_chooser.length){\n                        step_chooser.removeClass('no-click');\n                        step_chooser[0].removeEventListener('click', disableClick, true);\n\n                        // (Hacky) show report if read step was done\n                        if (oldstep == adata.steps.step_read) {\n                            that.controls.startreportbutton.removeClass('no-click');\n                        }\n\n                        // Record the newly opened step as 'open' for client side use\n                        //TO DO-  get this working\n                       // that.steps_open[key] = true;\n                        break;\n                    }\n                }\n            }\n        },\n\n        send_submission: function (filename, rectime) {\n            var that = this;\n            var shadowing = (that.stepshadow_enabled && that.letsshadow) ? 1 : 0;\n            Ajax.call([{\n                methodname: 'mod_readaloud_submit_regular_attempt',\n                args: {\n                    cmid: that.cmid,\n                    filename:  filename,//encodeURIComponent(filename),\n                    rectime: rectime,\n                    shadowing: shadowing\n                },\n                done: function(ajaxresult){\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch (payloadobject.success) {\n                            case true:\n                                log.debug('attempted submission accepted');\n                                break;\n                            case false:\n                            default:\n                                log.debug('attempted item evaluation failure');\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n/*\n            return;\n\n            //set up our ajax request\n            var xhr = new XMLHttpRequest();\n            var that = this;\n\n            //set up our handler for the response\n            xhr.onreadystatechange = function (e) {\n                if (this.readyState === 4) {\n                    if (xhr.status === 200) {\n                        log.debug('ok we got an attempt submission response');\n                        //get a yes or forgetit or tryagain\n                        var payload = xhr.responseText;\n                        var payloadobject = JSON.parse(payload);\n                        if (payloadobject) {\n                            switch (payloadobject.success) {\n                                case true:\n                                    log.debug('attempted submission accepted');\n\n                                    break;\n\n                                case false:\n                                default:\n                                    log.debug('attempted item evaluation failure');\n                                    if (payloadobject.message) {\n                                        log.debug('message: ' + payloadobject.message);\n                                    }\n                            }\n                        }\n                    } else {\n                        log.debug('Not 200 response:' + xhr.status);\n                    }\n                }\n            };\n\n            //to get through mod_security environments\n            filename = filename.replace(/^https:\\/\\//i, 'https___');\n            var params = \"cmid=\" + that.cmid + \"&filename=\" + encodeURIComponent(filename) + \"&rectime=\" + rectime;\n            xhr.open(\"POST\", M.cfg.wwwroot + '/mod/readaloud/ajaxhelper.php', true);\n            xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n            xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n            xhr.send(params);\n*/\n        },\n\n        domenulayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.feedbackcontainer.hide();\n            m.controls.hider.hide();\n            m.controls.practiceinstructionscontainer.hide();\n            m.controls.practicecontainerwrap.hide();\n            m.controls.modelaudioplayer.hide();\n            m.controls.previewinstructionscontainer.hide();\n            m.controls.progresscontainer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.quizcontainerwrap.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.returnmenubutton.hide();\n            m.controls.smallreportcontainer.hide();\n            m.controls.wheretonextcontainer.hide();\n\n            // Show.\n            m.controls.homecontainer.show();\n            m.controls.introbox.show();\n            m.controls.menuinstructionscontainer.show();\n            m.controls.menubuttonscontainer.show();\n\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\n            m.controls.modeimagecontainer.removeClass('d-block');\n            m.controls.modeimagecontainer.addClass('d-none');\n\n            modelaudiokaraoke.modeling=true;\n\n            // Update the mode statuses (completed, in-progress, upcoming).\n            m.updateModeStatuses();\n        },\n\n        doreadinglayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.feedbackcontainer.hide();\n            m.controls.homecontainer.hide();\n            m.controls.introbox.hide();\n            m.controls.menuinstructionscontainer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.progresscontainer.hide();\n            m.controls.quizcontainerwrap.hide();\n            m.controls.smallreportcontainer.hide();\n            m.controls.wheretonextcontainer.hide();\n            m.controls.passagecontainer.removeClass(m.passagefinished);\n\n            // Show.\n            m.controls.recordingcontainer.show();\n            m.controls.returnmenubutton.show();\n            m.controls.hider.fadeOut('fast');\n            m.controls.activityinstructionscontainer.show();\n\n            m.controls.passagecontainer.removeClass('previewmode shadowmode reviewmode nothingmode');\n            m.controls.passagecontainer.addClass('readmode');\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\n            m.controls.modeimagecontainer.removeClass('fa-comment fa-comments fa-headphones fa-circle-question fa-chart-simple');\n            m.controls.modeimagecontainer.addClass('fa-book-open-reader d-block');\n\n            modelaudiokaraoke.modeling=true;\n        },\n\n        dopreviewlayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.feedbackcontainer.hide();\n            m.controls.hider.hide();\n            m.controls.homecontainer.hide();\n            m.controls.introbox.hide();\n            m.controls.practiceinstructionscontainer.hide();\n            m.controls.practicecontainerwrap.hide();\n            m.controls.menuinstructionscontainer.hide();\n            m.controls.modelaudioplayer.hide();\n            m.controls.progresscontainer.hide();\n            m.controls.quizcontainerwrap.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.smallreportcontainer.hide();\n            m.controls.stopandplay.show();\n            m.controls.wheretonextcontainer.hide();\n\n            // Show.\n            m.controls.menubuttonscontainer.show();\n            m.controls.passagecontainer.show();\n            m.controls.previewinstructionscontainer.show();\n            m.controls.returnmenubutton.show();\n\n            m.controls.passagecontainer.removeClass('readmode shadowmode reviewmode nothingmode');\n            m.controls.passagecontainer.addClass('previewmode');\n            m.controls.stopandplay.removeClass('hidden').addClass('visible');\n            m.controls.modeimagecontainer.removeClass('fa-comment fa-comments fa-book-open-reader fa-circle-question fa-chart-simple');\n            m.controls.modeimagecontainer.addClass('fa-headphones d-block');\n\n            modelaudiokaraoke.modeling=false;\n        },\n\n        dopracticelayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.feedbackcontainer.hide();\n            m.controls.homecontainer.hide();\n            m.controls.hider.hide();\n            m.controls.introbox.hide();\n            m.controls.modelaudioplayer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.previewinstructionscontainer.hide();\n            m.controls.progresscontainer.hide();\n\n            m.controls.quizcontainerwrap.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.smallreportcontainer.hide();\n            m.controls.wheretonextcontainer.hide();\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\n\n            // Show.\n            m.controls.returnmenubutton.show();\n            m.controls.menubuttonscontainer.show();\n            m.controls.practiceinstructionscontainer.show();\n            m.controls.practicecontainerwrap.show();\n\n            m.controls.modeimagecontainer.removeClass('fa-headphones fa-comments fa-book-open-reader fa-circle-question fa-chart-simple');\n            m.controls.modeimagecontainer.addClass('fa-comment d-block');\n            modelaudiokaraoke.modeling=false;\n        },\n\n        dopassagelayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.introbox.hide();\n\n            m.controls.readingcontainer.addClass(def.containerfillscreen);\n        },\n\n        douploadlayout: function () {\n            var m = this;\n\n            m.controls.passagecontainer.addClass(m.passagefinished);\n            m.controls.hider.fadeIn('fast');\n            m.controls.progresscontainer.fadeIn('fast');\n        },\n\n\n        dofinishedlayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.quizcontainerwrap.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.returnmenubutton.hide();\n            m.controls.smallreportcontainer.hide();\n\n            // Show.\n            m.controls.menubuttonscontainer.show();\n            m.controls.feedbackcontainer.show();\n            m.controls.wheretonextcontainer.show();\n\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\n\n            m.controls.hider.fadeOut('fast');\n            m.controls.progresscontainer.fadeOut('fast');\n\n        },\n        doerrorlayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.passagecontainer.hide();\n            m.controls.quizcontainerwrap.hide();\n            m.controls.recordingcontainer.hide();\n\n            // Show.\n            m.controls.menubuttonscontainer.show();\n            m.controls.errorcontainer.show();\n            m.controls.wheretonextcontainer.show();\n\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\n\n            m.controls.hider.fadeOut('fast');\n            m.controls.progresscontainer.fadeOut('fast');\n        },\n        doreportlayout: function () {\n            var m = this;\n\n            // Hide.\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.homecontainer.hide();\n            m.controls.practiceinstructionscontainer.hide();\n            m.controls.practicecontainerwrap.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.previewinstructionscontainer.hide();\n            m.controls.menuinstructionscontainer.hide();\n            m.controls.quizcontainerwrap.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\n\n            //clean up upload layout\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\n            m.controls.hider.fadeOut('fast');\n            m.controls.progresscontainer.fadeOut('fast');\n\n            // Show.\n            m.controls.menubuttonscontainer.show();\n            m.controls.returnmenubutton.show();\n            m.controls.smallreportcontainer.show();\n\n            m.controls.modeimagecontainer.removeClass('fa-headphones fa-comment fa-comments fa-book-open-reader fa-circle-question');\n            m.controls.modeimagecontainer.addClass('fa-chart-simple d-block');\n        },\n        doquizlayout: function(){\n            var m = this;\n\n            // Hide.\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.homecontainer.hide();\n            m.controls.practiceinstructionscontainer.hide();\n            m.controls.practicecontainerwrap.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.previewinstructionscontainer.hide();\n            m.controls.quizplaceholder.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.smallreportcontainer.hide();\n\n            // Show.\n            m.controls.quizcontainerwrap.show();\n\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\n            m.controls.modeimagecontainer.removeClass('fa-headphones fa-comment fa-comments fa-book-open-reader fa-chart-simple');\n            m.controls.modeimagecontainer.addClass('fa-circle-question d-block');\n        },\n\n        // Shared helper for bigbuttonmenu and modejourney.\n        // Updates each step element based on its enabled/completed state.\n        // Assumes \"stepsOrder\" is fixed and that both templates output numeric data-step values.\n        // Marks report as complete if either of step_read or step_quiz is completed.\n        updateStepsStatus: function($container, itemSelector, renderCallback) {\n            var dd = this;\n            var stepsOrder = ['step_listen', 'step_practice', 'step_shadow', 'step_read', 'step_quiz', 'step_report'];\n            var stepsComplete = dd.activitydata.stepscomplete || {};\n            var stepsEnabled  = dd.activitydata.stepsenabled  || {};\n            var stepsMapping  = dd.activitydata.steps || {}; // Maps canonical keys to numeric values.\n\n            if (!$container || !$container.length) {\n                console.error('Container not found.');\n                return;\n            }\n\n            // Build an array of enabled step keys (in fixed order).\n            var enabledSteps = stepsOrder.filter(function(step) {\n                return !!stepsEnabled[step];\n            });\n\n            // Determine the first enabled but incomplete step (skip step_report).\n            var firstIncomplete = null;\n            for (var i = 0; i < enabledSteps.length; i++) {\n                var step = enabledSteps[i];\n                if (step === 'step_report') { continue; }\n                if (!(stepsComplete[step] === true || stepsComplete[step] === 'true')) {\n                    firstIncomplete = step;\n                    break;\n                }\n            }\n\n            // Process each element in the container.\n            $container.find(itemSelector).each(function() {\n                var $elem = $(this);\n                // Here data-step returns the numeric value.\n                var stepNumber = $elem.data(\"step\");\n                if (stepNumber === undefined || stepNumber === null) {\n                    console.error(\"Missing data-step on element, skipping.\");\n                    return true; // Continue.\n                }\n                // Reverse lookup: find the canonical step key that matches the numeric value.\n                var stepKey = null;\n                $.each(stepsMapping, function(key, value) {\n                    if (parseInt(value, 10) === parseInt(stepNumber, 10)) {\n                        stepKey = key;\n                        return false; // Break out of the loop.\n                    }\n                });\n                if (!stepKey) {\n                    console.error(\"No canonical step key found for data-step value:\", stepNumber);\n                    return true;\n                }\n                // Only process if enabled.\n                if (!stepsEnabled[stepKey]) {\n                    return true;\n                }\n                var status;\n                // Mark step_report as completed if step_read or step_quiz is completed.\n                if (stepKey === 'step_report' &&\n                    ((stepsComplete['step_read'] === true || stepsComplete['step_read'] === 'true') ||\n                     (stepsComplete['step_quiz'] === true || stepsComplete['step_quiz'] === 'true'))) {\n                    status = 'completed';\n                } else {\n                    var isComplete = (stepsComplete[stepKey] === true || stepsComplete[stepKey] === 'true');\n                    if (isComplete) {\n                        status = 'completed';\n                    } else if (stepKey === firstIncomplete) {\n                        status = 'in-progress';\n                    } else {\n                        status = 'upcoming';\n                    }\n                }\n                console.log('Step:', stepKey, 'status:', status);\n                renderCallback($elem, status, stepKey);\n            });\n        },\n\n        updateModeStatuses: function() {\n            var dd = this;\n            dd.updateStepsStatus(dd.controls.modejourneycontainer, '.mode', function($elem, status, stepKey) {\n                $elem.removeClass('completed in-progress upcoming').addClass(status);\n            });\n        },\n\n        updateBigButtonMenuModeStatus: function() {\n            var dd = this;\n            dd.updateStepsStatus(dd.controls.menubuttonscontainer, 'li.mode-chooser', function($elem, status, stepKey) {\n                var $iconSpan = $elem.find('.nav-completion-icon');\n                if ($iconSpan.length) {\n                    if (status === 'completed') {\n                        $iconSpan.html('<i class=\"fa-solid fa-circle-check text-success\" title=\"Complete\"></i>');\n                    } else if (status === 'in-progress') {\n                        $iconSpan.html('<i class=\"fa-regular fa-circle text-warning\" title=\"In progress\"></i>');\n                    } else { // Upcoming.\n                        $iconSpan.html('<i class=\"fa-solid fa-lock text-secondary\" title=\"Locked\"></i>');\n                    }\n                }\n            });\n        },\n\n        isandroid: function() {\n                if (/Android/i.test(navigator.userAgent)) {\n                    return true;\n                } else {\n                    return false;\n                }\n        }\n    };//end of returned object\n});//total end\n"],"names":["define","$","log","str","def","recorderhelper","modelaudiokaraoke","Ajax","notification","smallreporthelper","practice","quizhelper","clicktohear","disableClick","e","preventDefault","stopImmediatePropagation","debug","cmid","activitydata","holderid","recorderid","playerid","sorryboxid","controls","ra_recorder","rec_time_start","steps_enabled","steps_open","steps_complete","letsshadow","strings","passagefinished","clone","extend","this","init","props","dd","stepsenabled","stepsopen","stepscomplete","theid","widgetid","configcontrol","get","JSON","parse","value","remove","is_browser_ok","setupmodelaudio","setuppractice","setup_recorder","process_html","register_events","setup_strings","setupquiz","setupclicktohear","stepshadow_enabled","steplisten_enabled","domenulayout","show","get_strings","component","done","s","i","confirm_cancel_recording","confirm_read_again","karaoke_opts","breaks","audioplayerclass","practice_opts","language","region","phonetics","stt_guided","on_complete","update_activity_step","steps","step_practice","clicktohear_opts","token","ttsvoice","owner","attemptid","step_quiz","opts","hider","introbox","progresscontainer","feedbackcontainer","errorcontainer","passagecontainer","reviewpassagecontainer","recordingcontainer","dummyrecorder","recordercontainer","menubuttonscontainer","menuinstructionscontainer","previewinstructionscontainer","practiceinstructionscontainer","practicecontainerwrap","activityinstructionscontainer","recinstructionscontainerright","recinstructionscontainerleft","allowearlyexit","wheretonextcontainer","modelaudioplayer","homebutton","startlistenbutton","step_listen","startpracticebutton","startreadbutton","step_read","startshadowbutton","step_shadow","startquizbutton","readagainbutton","startreportbutton","step_report","returnmenubutton","stopandplay","smallreportcontainer","fullreportcontainer","readingcontainer","modeimagecontainer","modejourneycontainer","quizcontainer","quizcontainerwrap","quizplaceholder","quizresultscontainer","homecontainer","navigator","mediaDevices","getUserMedia","reset_recorder","reset","beginall","passagerecorded","play","eventdata","Date","getTime","dopassagelayout","scrollIntoView","behaviour","block","inline","douploadlayout","currentTime","pause","rectime","Math","ceil","send_submission","mediaurl","update_filename","start_check_for_results","doreportlayout","capturedspeech","speechresults","each","addEventListener","click","dopreviewlayout","keypress","which","dopracticelayout","doreadinglayout","confirm","isandroid","is","location","reload","hasClass","doquizlayout","on","$btn","pressed","attr","step","that","call","methodname","args","ajaxresult","adata","key","updateModeStatuses","updateBigButtonMenuModeStatus","open_next_step","fail","exception","oldstep","thestep","step_chooser","length","removeClass","removeEventListener","filename","shadowing","payloadobject","success","message","m","hide","addClass","containerfillscreen","modeling","fadeOut","fadeIn","dofinishedlayout","doerrorlayout","updateStepsStatus","$container","itemSelector","renderCallback","stepsComplete","stepsEnabled","stepsMapping","enabledSteps","filter","firstIncomplete","find","$elem","stepNumber","data","console","error","status","stepKey","parseInt","$iconSpan","html","test","userAgent"],"mappings":"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"}