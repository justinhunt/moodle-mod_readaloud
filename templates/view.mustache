<div id="{{M_COMPONENT}}" class="container-fluid mx-n3">
    <div class="card">
        <div class="card-header bg-transparent">
            {{#openclosedates.hasopenclosedates}}
            <div class="mod_readaloud_openclosedates">
                <div class="activity-dates mb-1">
                    {{#openclosedates.opendate}}
                    <div>
                        <strong>{{#str}} open, mod_readaloud {{/str}}</strong>
                        {{#userdate}}{{openclosedates.opendate}}, {{#str}}strftimedatetime, core_langconfig {{/str}}{{/userdate}}
                    </div>
                    {{/openclosedates.opendate}}

                    {{#openclosedates.closedate}}
                    <div>
                        <strong>{{#str}} until, mod_readaloud {{/str}}</strong>
                        {{#userdate}}{{openclosedates.closedate}}, {{#str}}strftimedatetime, core_langconfig {{/str}}{{/userdate}}
                    </div>
                    {{/openclosedates.closedate}}
                </div>
                <div class="activity-status">
                    {{#openclosedates.activitynotopenyet}}
                    <div class="alert alert-warning">{{#str}} activityisnotopenyet, mod_readaloud {{/str}}</div>
                    {{/openclosedates.activitynotopenyet}}

                    {{#openclosedates.activityisclosed}}
                    <div class="alert alert-danger alert-dismissible fade in" role="alert" data-aria-autofocus="true">
                        {{#str}} activityisclosed, mod_readaloud {{/str}}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Dismiss this notification</span>
                        </button>
                    </div>
                    {{/openclosedates.activityisclosed}}
                </div>
            </div>
            {{/openclosedates.hasopenclosedates}}
            <button
            aria-expanded="false"
            aria-controls="mod_readaloud_menubuttons_cont"
            type="button"
            class="btn nav-link float-sm-left navbar-toggler"
            data-toggle="toggle-mode-menu"
            data-side="left"
            data-preference="drawer-open-nav"
            id="menu-toggle"
            style="align-items: center; background-color: red; border-radius: 4px; display: flex; height: 40px; justify-content: center; margin-left: -3px; padding: 0; width: 40px;">
            <i class="slicon-menu navbar-toggler"></i>
            <span class="sr-only">Mode menu</span>
            </button>
        </div>

        {{#showintro}}
            {{{showintro}}}
        {{/showintro}}

        <div class="d-flex">
            {{>mod_readaloud/bigbuttonmenu}}
            <div class="readaloud-content">
                <div id="{{M_MODE_IMAGE_CONTAINER}}" class="mode-content-icon fa-solid text-primary d-block mx-auto mb-4"></div>

                <div id="{{M_PREVIEWINSTRUCTIONS_CONTAINER}}" class="{{M_PREVIEWINSTRUCTIONS_CONTAINER}}">
                    <div class="box">
                        <div class="{{M_CLASS}}_center {{M_PREVIEWINSTRUCTIONS}}">
                            {{#str}} previewhelp, mod_readaloud {{/str}}
                        </div>
                    </div>
                </div>

                <div id="{{M_LANDRINSTRUCTIONS_CONTAINER}}" class="{{M_LANDRINSTRUCTIONS_CONTAINER}}">
                    <div class="box">
                        <div class="{{M_CLASS}}_center {{M_LANDRINSTRUCTIONS}}">
                            {{#str}} landrhelp, mod_readaloud {{/str}}
                        </div>
                    </div>
                </div>

                {{#instructions}}
                <div id="{{M_ACTIVITYINSTRUCTIONS_CONTAINER}}" class="{{M_ACTIVITYINSTRUCTIONS_CONTAINER}}">
                    <div class="box py-3 generalbox">
                        <div class="{{M_CLASS}}_center {{M_INSTRUCTIONS}}">
                            {{{instructions}}}
                        </div>
                    </div>
                </div>
                {{/instructions}}

                {{#feedback}}
                <div id="{{M_FEEDBACK_CONTAINER}}" class="{{M_FEEDBACK_CONTAINER}}">
                    <div class="box">
                        <div class="{{M_CLASS}}_center">
                            {{{feedback}}}
                        </div>
                    </div>
                </div>
                {{/feedback}}

                {{#error}}
                <div id="{{M_ERROR_CONTAINER}}" class="{{M_ERROR_CONTAINER}}">
                    <div class="box">
                        <h3 class="main">{{#str}} errorheader, mod_readaloud {{/str}}</h3>
                        <div>{{#str}} uploadconverterror, mod_readaloud {{/str}}</div>
                    </div>
                </div>
                {{/error}}

                <div id="{{M_HOME_CONTAINER}}" class="{{M_HOME_CONTAINER}} mode-section active">
                    {{>mod_readaloud/home}}
                </div>

                <div id="{{M_QUIZ_CONTAINER}}" class="{{M_QUIZ_CONTAINER}}">
                    {{{quizhtml}}}
                </div>

                <div id="mod_readaloud_readingcontainer" class="mod_readaloud_readingcontainer">
                    {{{passagehtml}}}
                </div>
                <!-- Hidden input for update control -->
                <input id="{{M_UPDATE_CONTROL}}" type="hidden">

                <!-- Hidden input storing JSON configuration -->
                <input id="amdopts_{{activityamddata.widgetid}}" type="hidden" value="{{activityamddata.jsonstring}}">

                {{#recorder}}
                <div class="{{M_RECORDING_CONTAINER}}">
                    <div id="{{M_RECORDER_CONTAINER}}" class="{{M_RECORDER_CONTAINER}} {{M_CLASS_CENTER}}">
                        <div id="{{M_RECORDERID}}" class="{{M_CLASS_CENTER}}"
                            data-id="{{M_RECORDERID}}"
                            data-parent="{{wwwroot}}"
                            data-localloading="auto"
                            data-localloader="/mod/readaloud/poodllloader.html"
                            data-media="audio"
                            data-appid="{{M_COMPONENT}}"
                            data-owner="{{owner}}"
                            data-type="{{recorder_type}}"
                            data-width="{{recorder_width}}"
                            data-height="{{recorder_height}}"
                            data-updatecontrol="{{M_UPDATE_CONTROL}}"
                            data-timelimit="{{timelimit}}"
                            data-transcode="1"
                            data-transcribe="{{transcribe}}"
                            data-language="{{language}}"
                            data-expiredays="{{expiredays}}"
                            data-region="{{region}}"
                            data-fallback="warning"
                            data-speechevents="{{speechevents}}"
                            data-hints="{{hints}}"
                            data-token="{{token}}"
                            data-transcribevocab="{{transcribevocab}}">
                        </div>
                    </div>
                </div>
                {{/recorder}}

                {{#progress}}
                <div id="{{M_HIDER}}" class="{{M_HIDER}}"></div>
                <div id="{{M_PROGRESS_CONTAINER}}" class="{{M_PROGRESS_CONTAINER}}">
                    <h4>{{#str}} processing, mod_readaloud {{/str}}</h4>
                    <i class="fa fa-spinner fa-5x fa-spin"></i>
                </div>
                {{/progress}}

                {{#wheretonext}}
                <div class="{{M_WHERETONEXT_CONTAINER}} text-center">
                    {{#backtotop}}
                    <a class="{{M_CLASS}}_center btn btn-secondary {{M_BACKTOTOP}}"
                        id="{{M_BACKTOTOP}}"
                        href="{{backtotop_url}}">
                        {{#str}} backtotop, mod_readaloud {{/str}}
                    </a>
                    {{/backtotop}}

                    {{#nextactivity}}
                    <a class="{{M_CLASS}}_center btn btn-primary {{M_NEXTACTIVITY}}"
                        href="{{nextactivity_url}}">
                        {{nextactivity_label}}
                    </a>
                    {{/nextactivity}}
                </div>
                {{/wheretonext}}

                {{#landr}}
                    {{>mod_readaloud/modalcontainer}}
                {{/landr}}

                {{#smallreport}}
                    {{>mod_readaloud/smallreport}}
                {{/smallreport}}
                
                {{>mod_readaloud/hiddenaudioplayer}}

                {{#stopandplay}}
                <div id="{{M_STOPANDPLAY}}" class="d-flex justify-content-center hidden p-1">
                    <button id="{{M_STOP_BTN}}" class="btn btn-outline-primary m-2">
                        <i class="fa fa-stop"></i> {{#str}} stopbutton, mod_readaloud {{/str}}
                    </button>
                    <button id="{{M_PLAY_BTN}}" class="btn btn-primary m-2">
                        <i class="fa fa-play"></i> {{#str}} playbutton, mod_readaloud {{/str}}
                    </button>
                </div>
                {{/stopandplay}}
            </div>
        </div>
    </div>
</div>
{{#js}}
require(['mod_readaloud/togglemodemenu'], function(ToggleModeMenu) {
    ToggleModeMenu.init();
});
{{/js}}